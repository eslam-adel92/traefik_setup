# docker-compose.yml
version: '3.8'

services:
  traefik:
    image: traefik:v3.4
    container_name: traefik
    command:
      - --configFile=/etc/traefik/traefik.yaml
    ports:
      - "80:80"
      - "8080:8080"
    volumes:
      - /var/run/docker.sock:/var/run/docker.sock:ro
      - ./traefik.yaml:/etc/traefik/traefik.yaml:ro
      - ./coraza-config.yaml:/etc/traefik/coraza-config.yaml:ro
      # - ./data/certs:/var/traefik/certs:rw
    networks:
      - web

  whoami:
    image: traefik/whoami
    container_name: whoami-app
    labels:
      - "traefik.enable=true"
      - "traefik.http.routers.whoami.rule=Host(`localhost`)"
      - "traefik.http.routers.whoami.entrypoints=web"
      # Enable Coraza WAF for this service
      - "traefik.http.routers.whoami.middlewares=coraza-waf"

    volumes:
      - ./coraza-config.yaml:/etc/coraza/config.yaml:ro
    networks:
      - web

networks:
  web:
    driver: bridge